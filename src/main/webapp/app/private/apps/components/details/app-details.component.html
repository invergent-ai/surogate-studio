<sm-page-loader [loading]="loading">
  <ng-template>
    <form ngForm [formGroup]="applicationForm" (ngSubmit)="saveApplication()" class="p-fluid">
    <!-- Name -->
    <div class="field">
      <label for="name">Name:</label>
      <input type="text" pInputText id="name" formControlName="name" [class.ng-dirty]="applicationForm.dirty"
             placeholder="Enter application name"/>
      <small [class.text-red-500]="applicationForm.dirty && applicationForm.get('name')?.errors?.required">
        The name is required</small>
      <small [class.text-red-500]="applicationForm.dirty &&
               (applicationForm.get('name')?.errors?.minlength || applicationForm.get('name')?.errors?.maxlength)">
        and must be at least 3 and at most 50 characters.</small>
    </div>

    <!-- Description -->
    <div class="field">
      <label for="description">Description:</label>
      <textarea type="text" pInputTextarea rows="5" id="description" formControlName="description"
                placeholder="The description can contain any characters and the maximum length is 250 characters."></textarea>
    </div>

    <!-- Project -->
    <div class="field">
      <label for="project">Project:</label>
      <p-dropdown [options]="projects" id="project" inputId="project" optionLabel="name" optionDisabled="disabled"
                  formControlName="project" appendTo="body">
        <ng-template let-item pTemplate="item">
          <div class="flex flex-row column-gap-2 align-items-center">
            <span>{{item.name}}</span>
          </div>
        </ng-template>
        <ng-template pTemplate="selectedItem">
          <div class="flex flex-row column-gap-2 align-items-center">
            <span>{{applicationForm.get('project').value?.name}}</span>
          </div>
        </ng-template>
      </p-dropdown>
      <small [class.text-red-500]="applicationForm.dirty &&
           (applicationForm.get('project')?.errors?.['required'] || !applicationForm.get('project').getRawValue().id)">Choose a project for your app</small>
    </div>

    <div class="flex flex-row column-gap-3 mt-5">
      <button pButton type="submit" size="small" class="block w-8rem"
              [disabled]="!applicationForm.valid || isSaving"
              [loading]="isSaving">
        Continue
      </button>
      <button pButton size="small" severity="danger" type="button" class="block w-8rem " (click)="cancel()">Cancel</button>
    </div>
  </form>
  </ng-template>
</sm-page-loader>

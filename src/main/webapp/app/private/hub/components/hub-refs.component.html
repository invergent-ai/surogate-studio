<p-card>
  <ng-template pTemplate="header">
    <div class="p-3 surface-50 flex justify-content-between align-items-center">
      <p class="font-semibold">{{typeLabelPlural()}}</p>
      <div class="flex gap-2 align-items-center justify-content-end">
        <button pButton size="small" outlined (click)="refresh()">
          <i-lucide [img]="RefreshCw" class="w-1rem h-1rem"></i-lucide> &nbsp; Refresh
        </button>
        <button pButton size="small" (click)="create()">
          <i-lucide [img]="Plus" class="w-1rem h-1rem"></i-lucide> &nbsp; New {{typeLabel()}}
        </button>
      </div>
    </div>
  </ng-template>

  <p-table [value]="branchesOrTags()" [tableStyle]="{'table-layout': 'auto', 'width': '100%'}">
    <ng-template pTemplate="body" let-data>
      <tr>
        <td>
          <a [routerLink]="['/hub/files', repository().id]" [queryParams]="{'ref': data.id, 'refType': type()}">{{data.id}}</a>
          <p-tag *ngIf="repository()?.defaultBranch === data.id" value="DEFAULT"></p-tag>
        </td>
        <td>
          @if (repository()?.defaultBranch !== data.id) {
            <div class="flex justify-content-end">
              <button pButton size="small" severity="danger" (click)="delete($event, data)">
                <i-lucide [img]="Trash" class="w-1rem h-1rem"></i-lucide>
              </button>
            </div>
          }
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-card>

<p-dialog header="Add Branch" [(visible)]="addBranchDialogVisible" [modal]="true"
          [style]="{ width: '30vw' }" [closable]="true" [closeOnEscape]="true"
          [draggable]="false" [resizable]="false">
  <p class="text-sm text-500">Create a new Branch.</p>

  <form [formGroup]="addBranchForm">
    <div class="mt-3">
      <div class="field p-fluid">
        <label for="path">Name:</label>
        <input pInputText formControlName="name" placeholder="Branch name..." />
      </div>
    </div>

    <div class="mt-3">
      <div class="field p-fluid">
        <label for="path">From existing Branch/Tag/Commit:</label>
        <sm-ref-selector type="any" formControlName="ref" [repoId]="repository()?.id" [canSelect]="true"></sm-ref-selector>
      </div>
    </div>
  </form>

  <div class="flex gap-2 justify-content-center">
    <button pButton outlined size="small" label="Cancel" (click)="addBranchDialogVisible.set(false)"></button>
    <button pButton size="small" label="Create" [disabled]="!addBranchForm.valid" (click)="createBranch()"></button>
  </div>
</p-dialog>

<p-dialog header="Add Tag" [(visible)]="addTagDialogVisible" [modal]="true"
          [style]="{ width: '30vw' }" [closable]="true" [closeOnEscape]="true"
          [draggable]="false" [resizable]="false">
  <p class="text-sm text-500">Create a new Tag.</p>

  <form [formGroup]="addTagForm">
    <div class="mt-3">
      <div class="field p-fluid">
        <label for="path">Name:</label>
        <input pInputText formControlName="name" placeholder="Tag name..." />
      </div>
    </div>

    <div class="mt-3">
      <div class="field p-fluid">
        <label for="path">From existing Branch/Tag/Commit:</label>
        <sm-ref-selector type="any" formControlName="ref" [repoId]="repository()?.id" [canSelect]="true"></sm-ref-selector>
      </div>
    </div>
  </form>

  <div class="flex gap-2 justify-content-center">
    <button pButton outlined size="small" label="Cancel" (click)="addTagDialogVisible.set(false)"></button>
    <button pButton size="small" label="Create" [disabled]="!addTagForm.valid" (click)="createTag()"></button>
  </div>
</p-dialog>

<p-confirmDialog></p-confirmDialog>
